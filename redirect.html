<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .loader {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 3px solid rgba(0,0,0,.3);
            border-radius: 50%;
            border-top-color: #4285f4;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <h1>Redirecting you to the destination...</h1>
    <div class="loader"></div>
    <p id="target-display">Please wait...</p>
    
    <script>
        // Parse the URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const redirectId = urlParams.get('id');
        const directUrl = urlParams.get('url');
        
        // Function to handle redirection
        function redirectToTarget() {
            // If there's a direct URL parameter, use that
            if (directUrl) {
                document.getElementById('target-display').textContent = `Redirecting to: ${directUrl}`;
                window.location.href = directUrl;
                return;
            }
            
            // Otherwise try to get the redirect from local storage
            if (redirectId) {
                // Try to get all redirects from localStorage
                const redirectStore = JSON.parse(localStorage.getItem('qr-redirects') || '{}');
                
                // If we have this redirect ID
                if (redirectStore[redirectId]) {
                    const targetUrl = redirectStore[redirectId];
                    document.getElementById('target-display').textContent = `Redirecting to: ${targetUrl}`;
                    window.location.href = targetUrl;
                    return;
                }
            }
            
            // If we get here, we couldn't find a redirect
            document.getElementById('target-display').textContent = 'Error: Redirect not found.';
        }
        
        // Redirect after a short delay
        setTimeout(redirectToTarget, 500);
    </script>
</body>
</html>
